<?php

// Generated by Haxe 3.4.4
class tink_streams_StepWise extends tink_streams_StreamBase {
	public function next() {
		return new tink_core__Future_SyncFuture(new tink_core__Lazy_LazyConst(tink_streams_StreamStep::$End));
	}
	public function hforEach($item) {
		$_gthis = $this;
		return tink_core__Future_Future_Impl_::async(array(new _hx_lambda(array(&$_gthis, &$item), "tink_streams_StepWise_0"), 'execute'), null);
	}
	public function forEachAsync($item) {
		$_gthis = $this;
		return tink_core__Future_Future_Impl_::async(array(new _hx_lambda(array(&$_gthis, &$item), "tink_streams_StepWise_1"), 'execute'), null);
	}
	function __toString() { return 'tink.streams.StepWise'; }
}
function tink_streams_StepWise_0(&$_gthis, &$item, $cb) {
	{
		$next = null;
		$next = array(new _hx_lambda(array(&$_gthis, &$cb, &$item, &$next), "tink_streams_StepWise_2"), 'execute');
		$next1 = $next;
		call_user_func($next1);
	}
}
function tink_streams_StepWise_1(&$_gthis, &$item, $cb) {
	{
		$next = null;
		$next = array(new _hx_lambda(array(&$_gthis, &$cb, &$item, &$next), "tink_streams_StepWise_3"), 'execute');
		$next1 = $next;
		call_user_func($next1);
	}
}
function tink_streams_StepWise_2(&$_gthis, &$cb, &$item, &$next) {
	{
		while(true) {
			$touched = false;
			$_gthis->next()->handle(array(new _hx_lambda(array(&$cb, &$item, &$next, &$touched), "tink_streams_StepWise_4"), 'execute'));
			if(!$touched) {
				$touched = true;
				break;
			}
			unset($touched);
		}
	}
}
function tink_streams_StepWise_3(&$_gthis, &$cb, &$item, &$next) {
	{
		while(true) {
			$touched = false;
			$_gthis->next()->handle(array(new _hx_lambda(array(&$cb, &$item, &$next, &$touched), "tink_streams_StepWise_5"), 'execute'));
			if(!$touched) {
				$touched = true;
				break;
			}
			unset($touched);
		}
	}
}
function tink_streams_StepWise_4(&$cb, &$item, &$next, &$touched, $step) {
	{
		switch($step->index) {
		case 0:{
			$data = _hx_deref($step)->params[0];
			if(!call_user_func_array($item, array($data))) {
				call_user_func_array($cb, array(tink_core_Outcome::Success(false)));
			} else {
				if($touched) {
					call_user_func($next);
				} else {
					$touched = true;
				}
			}
		}break;
		case 1:{
			call_user_func_array($cb, array(tink_core_Outcome::Success(true)));
		}break;
		case 2:{
			$e = _hx_deref($step)->params[0];
			call_user_func_array($cb, array(tink_core_Outcome::Failure($e)));
		}break;
		}
	}
}
function tink_streams_StepWise_5(&$cb, &$item, &$next, &$touched, $step) {
	{
		switch($step->index) {
		case 0:{
			$data = _hx_deref($step)->params[0];
			call_user_func_array($item, array($data))->handle(array(new _hx_lambda(array(&$cb, &$next, &$touched), "tink_streams_StepWise_6"), 'execute'));
		}break;
		case 1:{
			call_user_func_array($cb, array(tink_core_Outcome::Success(true)));
		}break;
		case 2:{
			$e = _hx_deref($step)->params[0];
			call_user_func_array($cb, array(tink_core_Outcome::Failure($e)));
		}break;
		}
	}
}
function tink_streams_StepWise_6(&$cb, &$next, &$touched, $resume) {
	{
		if(!$resume) {
			call_user_func_array($cb, array(tink_core_Outcome::Success(false)));
		} else {
			if($touched) {
				call_user_func($next);
			} else {
				$touched = true;
			}
		}
	}
}
